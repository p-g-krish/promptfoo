# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json
description: SiliconFlow function calling demonstration

env:
  # Get your API key from https://cloud.siliconflow.cn/account/ak
  SILICONFLOW_API_KEY: ${SILICONFLOW_API_KEY}

providers:
  - id: deepseek
    provider: siliconflow:deepseek-ai/DeepSeek-V2.5
    config:
      temperature: 0.1
      max_tokens: 2000
      tools:
        - type: function
          function:
            name: get_weather
            description: Get the current weather for a given city
            parameters:
              type: object
              properties:
                city:
                  type: string
                  description: The name of the city to query weather for
              required:
                - city

  - id: qwen-fc
    provider: siliconflow:Qwen/Qwen2.5-72B-Instruct
    config:
      temperature: 0.7
      max_tokens: 2000
      tools:
        - type: function
          function:
            name: calculate_mortgage
            description: Calculate monthly mortgage payment
            parameters:
              type: object
              properties:
                loan_amount:
                  type: number
                  description: Total loan amount in currency units
                interest_rate:
                  type: number
                  description: Annual interest rate as a percentage
                term_years:
                  type: number
                  description: Loan term in years
              required:
                - loan_amount
                - interest_rate
                - term_years

prompts:
  - |
    我需要知道北京明天的天气如何。我应该带伞出门吗？
    (I need to know what the weather will be like in Beijing tomorrow. Should I take an umbrella?)

  - |
    上海今天的天气怎么样？气温多少？
    (What's the weather like in Shanghai today? What's the temperature?)

  - |
    我计划购买一处价值200万元的房产，首付30%，贷款年限30年，年利率4.8%。
    请计算我每月需要支付的房贷金额。
    (I plan to purchase a property worth 2 million yuan, with a 30% down payment, 
    a 30-year loan term, and an annual interest rate of 4.8%. 
    Please calculate my monthly mortgage payment.)

defaultTest:
  options:
    provider: deepseek

tests:
  # Test weather function call for Beijing
  - vars:
      prompt: '我需要知道北京明天的天气如何。我应该带伞出门吗？ (I need to know what the weather will be like in Beijing tomorrow. Should I take an umbrella?)'
    assert:
      - type: function-call
        value:
          name: get_weather
          arguments:
            city: '北京'
      - type: contains-any
        value: ['北京', 'Beijing', '天气', 'weather']

  # Test weather function call for Shanghai
  - vars:
      prompt: "上海今天的天气怎么样？气温多少？ (What's the weather like in Shanghai today? What's the temperature?)"
    assert:
      - type: function-call
        value:
          name: get_weather
          arguments:
            city: '上海'
      - type: contains-any
        value: ['上海', 'Shanghai', '温度', '气温', 'temperature']

  # Test mortgage calculation function
  - vars:
      prompt: '我计划购买一处价值200万元的房产，首付30%，贷款年限30年，年利率4.8%。请计算我每月需要支付的房贷金额。'
    options:
      provider: qwen-fc
    assert:
      - type: function-call
        value:
          name: calculate_mortgage
          arguments:
            loan_amount: 1400000
            interest_rate: 4.8
            term_years: 30
